{"version":3,"sources":["serverEngine/ST_Server.js"],"names":[],"mappings":"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","file":"serverEngine/ST_Server.js","sourcesContent":["\"use strict\";\r\n\r\n/*\r\n ST Server\r\n SomeThings Server\r\n \r\n \r\n - Provides the main class of ST server\r\n - Load configuration\r\n - Start managers\r\n - Start services\r\n - byebye for shutdown\r\n\r\n */\r\n\r\n// require our modules\r\nlet ServerConfiguration = require('./ServerConfiguration.js');\r\n\r\nlet NodesControlService = require('./NodesControlService.js');\r\nlet NodesManager = require('./NodesManager.js');\r\nlet SensorsManager = require('./SensorsManager.js');\r\nlet ActuatorsManager = require('./ActuatorsManager.js');\r\n\r\nlet NodesNetManager = require('./NodesNetManager.js');\r\nlet NodesNetService = require('./NodesNetService.js').NodesNetService;\r\n\r\n\r\nlet ServerControlService = require('./ServerControlService.js');\r\n\r\nlet COMSystem = require('../stNetwork/COMSystem.js').COMSystem;\r\n\r\nconst readline = require('readline');\r\n\r\n\r\n/**\r\n * ST Server\r\n */\r\nclass STServer {\r\n\t\r\n\tconstructor() {\r\n\t\tthis.serverConfiguration = null;\r\n\t\t\r\n\t\tthis.sensorsManager = null;\r\n\t\tthis.actuatorsManager = null;\r\n\t\tthis.nodesManager = null;\r\n\t\t\r\n\t\tthis.nodesControlService = null;\r\n\t\t\r\n\t\tthis.nodesNetManager = null;\r\n\t\tthis.nodesNetService = null;\r\n\t\t\r\n\t\tthis.serverControlService = null;\r\n\t\t\r\n\t\tthis.miniCLI = null;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize ST Server\r\n\t */\r\n\tinit_Server() {\r\n\t\t\r\n\t\tlet stServer = this;\r\n\t\t\r\n\t\tstServer.loadConfig();\r\n\t\t\r\n\t\t//--- ¨¨ --- ¨¨ --- ¨¨ --- ¨¨ --- \r\n\t\t// Sensors Manager \r\n\t\tstServer.sensorsManager = new SensorsManager();\r\n\r\n\t\t//--- ¨¨ --- ¨¨ --- ¨¨ --- ¨¨ --- \r\n\t\t// Actuators Manager \r\n\t\tstServer.actuatorsManager = new ActuatorsManager();\r\n\t\t\r\n\t\tstServer.init_NodesManager();\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Load configuration\r\n\t */\r\n\tloadConfig() {\r\n\t\t\r\n\t\tlet stServer = this;\r\n\t\t\r\n\t\tif (stServer.serverConfiguration != null) {\r\n\t\t\tthrow 'Server configuration is loaded.';\r\n\t\t}\r\n\t\t\r\n\t\t// --- ¨¨ --- ¨¨ --- ¨¨ --- ¨¨ --- \r\n\t\t// Server configuration \r\n\t\t// -------------------------------------------------------------------------------|\\/|---\r\n\t\tstServer.serverConfiguration = new ServerConfiguration();\r\n\r\n\t\tstServer.serverConfiguration.readFile();\r\n\r\n\t\tif (stServer.serverConfiguration.config == null) {\r\n\t\t\t\r\n\t\t\tconsole.log('Error in configuration');\t// TODO REMOVE DEBUG LOG\r\n\t\t\t\r\n\t\t\tprocess.exit(0);\r\n//\t\t\treturn -1;\r\n\t\t\t\r\n\t\t}\r\n\t\tconsole.log('<···> ST Server');\t// TODO REMOVE DEBUG LOG\r\n\t\tconsole.log(' <···> ServerConfiguration');\t// TODO REMOVE DEBUG LOG\r\n\t\tconsole.log(stServer.serverConfiguration.config);\t// TODO REMOVE DEBUG LOG\r\n\r\n\t\t//-------------------------------------------------------------------------------|/\\|---\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize Nodes manager\r\n\t */\r\n\tinit_NodesManager() {\r\n\t\t\r\n\t\tlet stServer = this;\r\n\t\t\r\n\t\tif (stServer.nodesManager != null) {\r\n\t\t\tthrow 'Nodes manager initialized.';\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t//--- ¨¨ --- ¨¨ --- ¨¨ --- ¨¨ --- \r\n\t\t// Nodes Manager \r\n\t\t//-------------------------------------------------------------------------------|\\/|---\r\n\t\tstServer.nodesManager = new NodesManager();\r\n\r\n\r\n\t\t// Map event NodeAdded\r\n\t\tstServer.nodesManager.eventEmitter.on(stServer.nodesManager.CONSTANTS.Events.NodeAdded, function(data){\r\n\t\t\tconsole.log('<···> ST Server.nodesManager');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> Events.NodeAdded');\t// TODO REMOVE DEBUG LOG\r\n\t\t\t\r\n\t\t\tstServer.sensorsManager.addSensorsFromNode( data.node );\t// bind Node to Sensors manager\r\n\t\t\tstServer.actuatorsManager.addActuatorsFromNode( data.node );\t// bind Node to Actuators manager\r\n\r\n\t\t});\r\n\r\n\t\t// Map event NodeRemoved\r\n\t\tstServer.nodesManager.eventEmitter.on(stServer.nodesManager.CONSTANTS.Events.NodeRemoved, function(data){\r\n\t\t\tconsole.log('<···> ST Server.nodesManager');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> Events.NodeRemoved');\t// TODO REMOVE DEBUG LOG\r\n\r\n\t\t});\r\n\t\t//-------------------------------------------------------------------------------|/\\|---\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize Nodes Control Service\r\n\t */\r\n\tinit_NodesControlService() {\r\n\t\t\r\n\t\tlet stServer = this;\r\n\t\t\r\n\t\tif (stServer.nodesControlService != null) {\r\n\t\t\tthrow 'Nodes Control Service initialized.';\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t//--- ¨¨ --- ¨¨ --- ¨¨ --- ¨¨ --- \r\n\t\t// Nodes control Service \r\n\t\t//-------------------------------------------------------------------------------|\\/|---\r\n\r\n\t\tstServer.nodesControlService = new NodesControlService( stServer.serverConfiguration.config );\r\n\r\n\t\t\r\n\t\tstServer.nodesControlService.eventEmitter.on(stServer.nodesControlService.CONSTANTS.Events.ConfigError, function(data){\r\n\t\t\tconsole.log('EEE> ST Server.ConfigError');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> Configuration error.');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tstServer._byebye();\r\n\t\t});\r\n\r\n\t\tstServer.nodesControlService.eventEmitter.on(stServer.nodesControlService.CONSTANTS.Events.ServerListening, function(data){\r\n\t\t\tconsole.log('<···> ST Server.nodesControlService');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> Server Listening');\t// TODO REMOVE DEBUG LOG\r\n\r\n\t\t});\r\n\r\n\t\tstServer.nodesControlService.eventEmitter.on(stServer.nodesControlService.CONSTANTS.Events.ServerClosed, function(data){\r\n\t\t\tconsole.log('<···> ST Server.nodesControlService');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> Server Closed');\t// TODO REMOVE DEBUG LOG\r\n\r\n\t\t});\r\n\r\n\t\tstServer.nodesControlService.eventEmitter.on(stServer.nodesControlService.CONSTANTS.Events.NodeConnected, function(data){\r\n\t\t\tconsole.log('<···> ST Server.nodesControlService');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> Events.NodeConnected');\t// TODO REMOVE DEBUG LOG\r\n\t\t\t\r\n\t\t\tstServer.nodesManager.addNode(null, data.socket);\r\n\t\t});\r\n\r\n\t\tstServer.nodesControlService.eventEmitter.on(stServer.nodesControlService.CONSTANTS.Events.NodeDisconnected, function(data){\r\n\t\t\tconsole.log('<···> ST Server.nodesControlService');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> Events.NodeDisconnected');\t// TODO REMOVE DEBUG LOG\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tstServer.nodesControlService.startService();\r\n\r\n\t\t} catch (e) {\r\n\t\t\t// TODO: handle exception\r\n\t\t\tconsole.log('Cannot start the service');\t// TODO REMOVE DEBUG LOG\r\n\r\n\t\t}\r\n\t\t//-------------------------------------------------------------------------------|/\\|---\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize Nodes Net manager\r\n\t */\r\n\tinit_NodesNetManager() {\r\n\t\t\r\n\t\tlet stServer = this;\r\n\t\t\r\n\t\tif (stServer.nodesNetManager != null) {\r\n\t\t\tthrow 'Nodes net manager initialized.';\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t//--- ¨¨ --- ¨¨ --- ¨¨ --- ¨¨ --- \r\n\t\t// Nodes net Manager \r\n\t\tstServer.nodesNetManager = new NodesNetManager();\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize Nodes Net service\r\n\t */\r\n\tinit_NodesNetService() {\r\n\t\t\r\n\t\tlet stServer = this;\r\n\t\t\r\n\t\tif (stServer.nodesNetService != null) {\r\n\t\t\tthrow 'Nodes net service initialized.';\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t//--- ¨¨ --- ¨¨ --- ¨¨ --- ¨¨ --- \r\n\t\t// Nodes net service \r\n\t\tstServer.nodesNetService = new NodesNetService(stServer.nodesManager, stServer.nodesNetManager);\r\n\t\tstServer.nodesNetService.initialize();\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize COM system\r\n\t */\r\n\tinit_ServerCOMSystem() {\r\n\t\t\r\n\t\tlet stServer = this;\r\n\t\t\t\r\n\t\tif (stServer.comSYS != null) {\r\n\t\t\tthrow 'Server COM System initialized.';\r\n\t\t}\r\n\t\t\r\n\t\t\r\n//\t\tlet socket = stServer.nodesManager.socket;\r\n\t\t\r\n\t\t//--- ¨¨ --- ¨¨ --- ¨¨ --- ¨¨ --- \r\n\t\t// COM System \r\n\t\tlet comSYS_Config = {\r\n\t\t\t\"controlChannel\" : null,\r\n\t\t\t\"role\" : \"Server\",\r\n\t\t\t\"nodesManager\" : stServer.nodesManager,\r\n\t\t\t\"nodesNetManager\" : stServer.nodesNetManager,\r\n\t\t\t\"sensorManager\" : stServer.sensorsManager,\r\n\t\t\t\"actuatorsManager\" : stServer.actuatorsManager,\r\n\t\t\t\"nodesNetManager\" : stServer.nodesNetManager\r\n\r\n\t\t}\r\n\t\t\r\n\t\tstServer.comSYS = COMSystem.getCOMSystem(comSYS_Config);\r\n\t\t\r\n\t\ttry {\r\n\t\t\tstServer.comSYS.initialize();\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log('<EEE> ST Server.init_ServerCOMSystem');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> ' + e);\t// TODO REMOVE DEBUG LOG\r\n\t\t\tstServer._byebye();\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize Server Control Service\r\n\t * \r\n\t * Is the server for manage messages HTTP/REST\r\n\t */\r\n\tinit_ServerControlService() {\r\n\t\t\r\n\t\tlet stServer = this;\r\n\t\t\r\n\t\tif (stServer.serverControlService != null) {\r\n\t\t\tthrow 'Server Control Service initialized.';\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t//--- ¨¨ --- ¨¨ --- ¨¨ --- ¨¨ --- \r\n\t\t// Server control Service \r\n\t\t//-------------------------------------------------------------------------------|\\/|---\r\n\r\n\t\tstServer.serverControlService = new ServerControlService( this );\r\n\r\n\t\tstServer.serverControlService.eventEmitter.on(stServer.serverControlService.CONSTANTS.Events.ServerListening, function(data){\r\n\t\t\tconsole.log('<···> ST Server.serverControlService');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> Server Listening');\t// TODO REMOVE DEBUG LOG\r\n\r\n\t\t});\r\n\r\n\t\tstServer.serverControlService.eventEmitter.on(stServer.serverControlService.CONSTANTS.Events.ServerClosed, function(data){\r\n\t\t\tconsole.log('<···> ST Server.serverControlService');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> Server Closed');\t// TODO REMOVE DEBUG LOG\r\n\r\n\t\t});\r\n\t\t\r\n\t\tstServer.serverControlService.eventEmitter.on(stServer.serverControlService.CONSTANTS.Events.ConfigError, function(data){\r\n\t\t\tconsole.log('<EEE> ST Server.serverControlService');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> Config Error');\t// TODO REMOVE DEBUG LOG\r\n\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tstServer.serverControlService.startService();\r\n\t\t} catch (e) {\r\n\t\t\t// TODO: handle exception\r\n\t\t\tconsole.log('<EEE> ST Server.serverControlService');\t// TODO REMOVE DEBUG LOG\r\n\t\t\tconsole.log(' <···> ' + e.message);\t// TODO REMOVE DEBUG LOG\r\n\t\t}\r\n\t\t//-------------------------------------------------------------------------------|/\\|---\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * ByeBye method...\r\n\t */\r\n\t_byebye() {\r\n\t\tlet stServer = this;\r\n\t\t\r\n\t\tconsole.log('Have a great day!');\r\n\t\t  \r\n\t  stServer.nodesControlService.stopService();\r\n\t  stServer.serverControlService.stopService();\r\n\r\n\t  process.exit(0);\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize Mini CLI\r\n\t */\r\n\tinit_MiniCLI() {\r\n\r\n\t\tlet stServer = this;\r\n\t\t\r\n\t\tif (stServer.miniCLI != null) {\r\n\t\t\tthrow 'Mini CLI initialized.';\r\n\t\t}\r\n\t\t\r\n\t\tstServer.miniCLI = readline.createInterface(process.stdin, process.stdout);\r\n\t\tstServer.miniCLI.setPrompt('STServer> ');\r\n\t\tstServer.miniCLI.prompt();\r\n\r\n\t\tstServer.miniCLI.on('line', function(line) {\r\n\t\t\tvar line_ = line.trim();\r\n\t\t  switch(line_) {\r\n\t\t      \r\n\t\t    case 'nodeslist':\r\n\t\t        console.log('>>> NODES List');\r\n\t\t        console.log( stServer.nodesManager.nodeList);\r\n\t\t        break;\r\n\t\t        \r\n\t\t    case 'sensorslist':\r\n\t\t        console.log('>>> Sensors List');\r\n\t\t        console.log( stServer.sensorsManager.sensorList);\r\n\t\t        break;\r\n\t\t        \r\n\t\t    case 'actuatorslist':\r\n\t\t        console.log('>>> Actuators List');\r\n\t\t        console.log( stServer.actuatorsManager.actuatorsList);\r\n\t\t        break;\r\n\t\t        \r\n\t\t    case 'help':\r\n\t\t    \tvar msg = '>>> Help Menu \\n';\r\n\t\t    \tmsg += 'nodeslist: list of nodes... \\n';\r\n\t\t    \tmsg += 'sensorslist: list of sensors... \\n';\r\n\t\t    \tmsg += 'actuatorslist: list of actuatorslist... \\n';\r\n\t\t    \tmsg += 'help: this help...';\r\n\t\t    \t\r\n\t\t        console.log(msg);\r\n\t\t        break;\r\n\t\t        \r\n\t\t        \r\n\t\t    default:\r\n\t\t    \tif (line_ != '') {\r\n\t\t    \t      console.log('>???> Say what? I might have heard `' + line_ + '`');\r\n\t\t    \t}\r\n\t\t      break;\r\n\t\t  }\r\n\t\t  \r\n\t\t  stServer.miniCLI.prompt();\r\n\t\t  \r\n\t\t}).on('close', function() {\r\n\t\t\tstServer._byebye();\r\n\t\t});\r\n\r\n\t}\r\n\t\r\n}\r\n\r\n\r\nmodule.exports = STServer;\r\n"],"sourceRoot":"C:\\Users\\Felipe\\Documents\\Work\\SomeThings\\dev\\NLVL_STServer\\es6"}