{"version":3,"sources":["serverEngine/ServerControlService.js"],"names":[],"mappings":"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","file":"serverEngine/ServerControlService.js","sourcesContent":["\"use strict\";\r\n\r\n/*\r\n Server control service\r\n \r\n - Provides server control service\r\n - Map routes to sensors control\r\n - Map routes to actuators control\r\n - Map routes to nodes control\r\n - Map routes to nodes net control\r\n\r\n \r\n \r\n */\r\n\r\nlet EventEmitter = require('events').EventEmitter;\r\nlet portscanner = require('portscanner');\r\nlet express = require('express');\r\n\r\n\r\nlet SCS_RouteSensors = require('./scs_routes/SCS_RouteSensors.js');\r\nlet SCS_RouteActuators = require('./scs_routes/SCS_RouteActuators.js');\r\nlet SCS_RouteNodes = require('./scs_routes/SCS_RouteNodes.js');\r\nlet SCS_RouteNetNodes = require('./scs_routes/SCS_RouteNetNodes.js');\r\n\r\n\r\n\r\n\r\n/**\r\n * ServerControlService CONSTANTS\r\n */\r\nconst ServerControlService_CONSTANTS = {\r\n\t\"Events\" : {\r\n\t\t\"ConfigError\": \"Config Error\",\r\n\r\n\t\t\"ServerListening\": \"Server listening\",\r\n\t\t\"ServerClosed\": \"Server closed\"\r\n\r\n\t},\r\n\t\r\n\t\"States\" : {\r\n\t\t\"Config\" : \"Config\",\r\n\t\t\"Running\" : \"Running\",\r\n\t\t\"Error\" : \"Error\"\r\n\t},\r\n\t\r\n\t\"Messages\" : {\r\n\t\t\"getSTNetworkInfo\" : \"Get STNetwork Info\",\r\n\t\t\"STNetworkInfo\" : \"STNetwork Info\"\r\n\r\n\t}\r\n};\r\n\r\n\r\n\r\n/*\r\n * ServerControlService\r\n * \r\n * Is the service for send and receive data control for Server administration\r\n * \r\n */\r\nclass ServerControlService {\r\n\t\r\n\tconstructor(stServer) {\r\n\t\t\r\n\t\tthis.stServer = stServer;\r\n\t\tthis.config = stServer.serverConfiguration.config;\r\n\t\tthis.server = null;\r\n\t\tthis.serverSocket = null;\r\n\t\tthis.eventEmitter = new EventEmitter();\r\n\t\t\r\n\t\tthis.CONSTANTS = ServerControlService_CONSTANTS;\r\n\t\t\r\n\t\tthis.state = ServerControlService_CONSTANTS.States.Config;\r\n\t\t\r\n\t\tthis.routes_Sensors = null;\r\n\t\tthis.routes_Actuators = null;\r\n\t\tthis.routes_Nodes = null;\r\n\t\tthis.routes_NetNodes = null;\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Start service\r\n\t * \r\n\t * @throws Exceptions\r\n\t */\r\n\tstartService() {\r\n\t\t\r\n\t\tif (this.server != null) {\r\n\t\t\t throw \"Server is running\";\r\n\t\t}\r\n\t\t\r\n\t\tlet scs = this;\r\n\t\t\r\n\t\tscs.server = express();\r\n//\t\tscs.server.use(express.bodyParser());\t// Middleware for use JSON on HTTP posts.\r\n\t\tscs.mapServiceRoutes();\r\n\r\n\t\t\r\n//\t\tDataChannel.portInUse( scs.config.server.controlPort, function(_portInUse) {\r\n//\t\t\tif (_portInUse) {\r\n//\t\t\t\tscs.eventEmitter.emit( scs.CONSTANTS.Events.ConfigError );\r\n//\t\t\t} else {\r\n//\t\t\t\tscs.serverSocket = scs.server.listen( scs.config.server.controlPort );\r\n//\t\t\t\tscs.eventEmitter.emit( scs.CONSTANTS.Events.ServerListening );\r\n//\t\t\t}\r\n//\t\t});\r\n\t\t\t\r\n\t\t\r\n\t\t// Checks the status of a single port\r\n\t\tportscanner.checkPortStatus(scs.config.server.controlPort, '127.0.0.1', function(error, status) {\r\n\t\t  // Status is 'open' if currently in use or 'closed' if available\r\n\t\t  \r\n\t\t  switch (status) {\r\n\t\t\tcase 'closed':\r\n\t\t\t\tscs.serverSocket = scs.server.listen( scs.config.server.controlPort );\r\n\t\t\t\tscs.state = scs.CONSTANTS.States.Running;\r\n\t\t\t\tscs.eventEmitter.emit( scs.CONSTANTS.Events.ServerListening );\r\n\t\t\t\tbreak;\r\n\t\r\n\t\t\tdefault:\r\n\t\t\t\tscs.state = scs.CONSTANTS.States.Error;\r\n\t\t\t\tscs.eventEmitter.emit( scs.CONSTANTS.Events.ConfigError );\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n//\t\ttry {\r\n//\t\t\tscs.serverSocket = scs.server.listen( scs.config.server.controlPort );\r\n//\t\t\tscs.eventEmitter.emit( scs.CONSTANTS.Events.ServerListening );\r\n//\t\t} catch (e) {\r\n//\t\t\t// TODO: handle exception\r\n//\t\t\tscs.eventEmitter.emit( scs.CONSTANTS.Events.ConfigError );\r\n//\r\n//\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Map Service routes\r\n\t */\r\n\tmapServiceRoutes() {\r\n\t\t\r\n\t\tthis.server.get('/', function(req, res){\r\n\t\t\t  res.send('ST Server Control Service');\r\n\t\t\t});\r\n\r\n\t\tthis.routes_Sensors = new SCS_RouteSensors( this.stServer.sensorsManager );\r\n\t\tthis.server.use('/Sensors', this.routes_Sensors.expressRoute);\r\n\t\t\r\n\t\tthis.routes_Actuators = new SCS_RouteActuators( this.stServer.actuatorsManager );\r\n\t\tthis.server.use('/Actuators', this.routes_Actuators.expressRoute);\r\n\r\n\t\tthis.routes_Nodes = new SCS_RouteNodes( this.stServer.nodesManager );\r\n\t\tthis.server.use('/Nodes', this.routes_Nodes.expressRoute);\r\n\r\n\t\tthis.routes_NetNodes = new SCS_RouteNetNodes(this.stServer.nodesManager, this.stServer.nodesNetManager);\r\n\t\tthis.server.use('/Net/Nodes', this.routes_NetNodes.expressRoute);\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * Stop service\r\n\t * \r\n\t * @throws Exceptions\r\n\t */\r\n\tstopService() {\r\n\t\r\n\t\tif (this.server == null) {\r\n\t\t\t throw \"Server not running\";\r\n\t\t}\r\n\t\t\r\n\t\tif (this.state == this.CONSTANTS.States.Running) {\r\n\t\t\tthis.serverSocket.close();\r\n\t\t}\r\n\t\t\r\n\t\tthis.eventEmitter.emit( this.CONSTANTS.Events.ServerClosed );\r\n\t\tthis.server = null;\r\n\t\tthis.serverSocket = null;\r\n\t}\r\n\t\r\n}\r\n\r\n\r\n\r\nmodule.exports = ServerControlService;"],"sourceRoot":"C:\\Users\\Felipe\\Documents\\Work\\SomeThings\\dev\\NLVL_STServer\\es6"}